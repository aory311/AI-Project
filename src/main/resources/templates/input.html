<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ­ãƒ¼ãƒ³ï¼†å…‰ç†±è²»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ - å…¥åŠ›ç”»é¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'ãƒ¡ã‚¤ãƒªã‚ª', Meiryo, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: bold;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }
        
        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .input-hint {
            font-size: 12px;
            color: #888;
            margin-top: 4px;
        }
        
        .submit-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }
        
        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .submit-button:active {
            transform: translateY(0);
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
        }
        /* å‡¦ç†ä¸­ã®ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .submit-button:disabled {
            background: #a0aec0; /* ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ */
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ */
        .loader {
            display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .submit-button:disabled {
        background: linear-gradient(135deg, #a0aec0 0%, #718096 100%); /* ã‚°ãƒ¬ãƒ¼ã«å¤‰æ›´ */
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ  ãƒ­ãƒ¼ãƒ³ï¼†å…‰ç†±è²»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
        
        <div th:if="${error}" class="error-message" style="background: #fee; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #e74c3c;">
            <strong>ã‚¨ãƒ©ãƒ¼:</strong> <span th:text="${error}"></span>
        </div>
        
        <form th:action="@{/simulation/calculate}" th:object="${simulationInput}" method="post">
            <div class="form-group">
                <label for="annualIncome">å¹´åï¼ˆä¸‡å††ï¼‰</label>
                <input type="number" id="annualIncome" th:field="*{annualIncome}" 
                       min="0" step="1" required>
                <div class="input-hint">ç¨è¾¼ã¿å¹´åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
            </div>
            
            <div class="form-group">
                <label for="budget">äºˆç®—ï¼ˆä¸‡å††ï¼‰</label>
                <input type="number" id="budget" th:field="*{budget}" 
                       min="0" step="1" required>
                <div class="input-hint">ä½å®…è³¼å…¥ã®äºˆç®—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
            </div>
            
            <div class="form-group">
                <label for="currentRent">ç¾åœ¨ã®å®¶è³ƒï¼ˆå††ï¼‰</label>
                <input type="number" id="currentRent" th:field="*{currentRent}" 
                       min="0" step="1000" required>
                <div class="input-hint">ç¾åœ¨ãŠæ”¯æ‰•ã„ä¸­ã®æœˆé¡å®¶è³ƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
            </div>

            <div class="form-group">
                <label for="familyComposition">å®¶æ—æ§‹æˆ</label>
                <select th:field="*{familyComposition}" 
                        id="familyComposition" 
                        name="familyComposition"
                        required 
                        onchange="handleCompositionChange(event)">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="å˜èº«">å˜èº«</option>
                    <option value="å¤«å©¦2äºº">å¤«å©¦2äºº</option>
                    <option value="å¤«å©¦+å­1äºº">å¤«å©¦+å­1äºº</option>
                    <option value="å¤«å©¦+å­2äºº">å¤«å©¦+å­2äºº</option>
                    <option value="å¤«å©¦+å­3äºº">å¤«å©¦+å­3äºº</option>
                    <option value="ãã®ä»–">ãã®ä»–</option>
                </select>
                <div class="input-hint">ã”å®¶æ—ã®æ§‹æˆã‚’é¸æŠã—ã¦ãã ã•ã„</div>
            </div>
            
            <div id="otherInputGroup" class="form-group" style="display: none;">
                <label for="customFamilySize">åˆè¨ˆäººæ•°ï¼ˆåŠè§’æ•°å­—ï¼‰</label>
                <input type="number" 
                       id="customFamilySize" 
                       th:field="*{customFamilySize}" 
                       min="1" max="20" 
                       placeholder="ä¾‹: 6"
                       oninput="value = value.replace(/[^0-9]+/g, '');">
            </div>
            
            <script>
            function handleCompositionChange(event) {
                // ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸè¦ç´ ï¼ˆselectï¼‰ã‹ã‚‰ç›´æ¥å€¤ã‚’å–å¾—
                const selectElement = event.target;
                const selectedValue = selectElement.value;
                
                const otherGroup = document.getElementById('otherInputGroup');
                const customInput = document.getElementById('customFamilySize');
            
                if (selectedValue === "ãã®ä»–") {
                    otherGroup.style.display = "block";
                    customInput.required = true;
                } else {
                    otherGroup.style.display = "none";
                    customInput.required = false;
                    customInput.value = ""; 
                }
            }
            
            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸè¡¨ç¤º
            document.addEventListener('DOMContentLoaded', function() {
                const el = document.getElementById('familyComposition');
                if (el) {
                    // åˆæœŸçŠ¶æ…‹ã‚’åæ˜ ã•ã›ã‚‹ãŸã‚ã«å½ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã™
                    handleCompositionChange({ target: el });
                }
            });

            document.getElementById('simulationForm').addEventListener('submit', function() {
            const btn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');

            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¦äºŒé‡é€ä¿¡ã‚’é˜²ã
            btn.disabled = true;

            // ãƒœã‚¿ãƒ³ã®æ–‡å­—ã‚’æ›¸ãæ›ãˆã‚‹
            // ã€ŒAIã€ã¨ã„ã†è¨€è‘‰ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã€èª²é¡Œã®ãƒ†ãƒ¼ãƒã‚’å¼·èª¿ã—ã¾ã™
            btnText.innerText = "AIåˆ†æï¼†è¨ˆç®—ä¸­...";
            
            // å°‘ã—é€éã•ã›ã¦ã€Œå‡¦ç†ä¸­ã€ã‚’æ¼”å‡º
            btn.style.opacity = "0.8";
            });
            
            function startLoading(buttonElement) {
            // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ï¼ˆæœªå…¥åŠ›ãŒãªã„ã‹ï¼‰
            const form = document.getElementById('simulationForm');
            if (!form.checkValidity()) {
                return true; // ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å„ªå…ˆã•ã›ã‚‹
            }

            // æ–‡å­—ã‚’æ›¸ãæ›ãˆã‚‹ãŸã‚ã®è¦ç´ ã‚’å–å¾—
            const btnText = document.getElementById('btnText');

            // 1. ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ï¼ˆäºŒé‡é€ä¿¡é˜²æ­¢ï¼‰
            // â€»setTimeoutã‚’ä½¿ã‚ãªã„ã¨ã€ç„¡åŠ¹åŒ–ãŒæ—©ã™ãã¦ãƒ•ã‚©ãƒ¼ãƒ ãŒé€ä¿¡ã•ã‚Œãªã„å ´åˆãŒã‚ã‚Šã¾ã™
            setTimeout(() => {
                buttonElement.disabled = true;
            }, 1);

            // 2. æ–‡å­—ã‚’æ›¸ãæ›ãˆã‚‹
            btnText.innerText = "AIåˆ†æï¼†è¨ˆç®—ä¸­...";

            // 3. è¦‹ãŸç›®ã‚’å°‘ã—å¤‰ãˆã‚‹ï¼ˆå‡¦ç†ä¸­ã‚’æ¼”å‡ºï¼‰
            buttonElement.style.opacity = "0.7";
            buttonElement.style.cursor = "not-allowed";

            return true; // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’ç¶™ç¶š
            }
            </script>
            
            <form th:action="@{/simulation/calculate}" th:object="${simulationInput}" method="post" id="simulationForm">
                <button type="submit" class="submit-button" id="submitBtn" onclick="return startLoading(this)">
                    <span id="btnText">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</span>
                </button>
            </form>
        </form>
    </div>
</body>
</html>

